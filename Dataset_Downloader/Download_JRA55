#!/bin/sh
#"""
#Copyright Netherlands eScience Center
#
#Function        : Download JRA55 Atmospheric Reanalysis Data
#Author          : Yang Liu
#Date            : 2017.8.26
#Last Update     : 2017.8.28
#Description     : The code aims to download atmospheric reanalysis data JRA55
#                  from JDDS FTP. The data files have the format GRIB 1.
#
#Attention       : Please refrain from making multiple connections and remaining
#                  connected for extended periods when downloading data. Users are
#                  asked to kindly limit connection time to 12 hours a day in total.
#
#Return Value    : GRIB 1 file
#variables       : Absolute Temperature              T
#                  Specific Humidity                 q
#                  Logarithmic Surface Pressure      lnsp
#                  Zonal Divergent Wind              u
#                  Meridional Divergent Wind         v
#                  Surface geopotential              z
#Caveat!!        : The data is from 90 deg south to 90 deg north (Globe).
#"""
#==============================================================================
#--------------------   specify all the parameter   ---------------------------
#==============================================================================
year=1980
Host='ds.data.jma.go.jp'
User='jra04269'
Password='jOBk9Oug'
#==============================================================================
touch download_JRA55.log
#sleep 10
# log-on to the JMA Data Dissemination System (JDDS)
#!! A useful tip for spawning any process
# <<EOF
# so the ftp process is fed on stdin with everything up to EOF
#-i turns off interactive prompting.
#-n Restrains FTP from attempting the auto-login feature.
#-v enables verbose and progress.
# between heredoc no comment allowed
ftp -inv $Host << End-Of-Session
user $User $Password
binary
cd JRA-55/Hist/Daily/anl_mdl/${year}01
get anl_mdl_hgt.${year}010100
get anl_mdl_tmp.${year}013006
cd ../../anl_surf/198001
get anl_surf.${year}013006
bye
echo "Downloading complete!!" >> download_JRA55.log
echo $year >> download_JRA55.log
End-Of-Session

#coding example
HOST='ds.data.jma.go.jp'
USER='***'
ASSWD='***'

STR="fcst_phy3m125_gwdua."

YEAR=1979
MONTH=01


while [  $YEAR -lt 2014 ]; do

		echo $YEAR`printf "%02d" $MONTH`

/usr/bin/ftp -inv $HOST<<EOF
user $USER $ASSWD
binary
cd JRA-55/Hist/Monthly/fcst_phy3m125
get $STR$YEAR`printf "%02d" $MONTH`
bye
EOF
sleep 2

		let MONTH=MONTH+1
		if [ $MONTH = 13 ]; then
		MONTH=1
		let YEAR=YEAR+1
 		fi
done
exit
